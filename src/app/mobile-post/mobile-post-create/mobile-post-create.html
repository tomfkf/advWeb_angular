<div class="ui raised segment form-container">

    <div class="ui header">{{ 'MOBILE_POST.TITLE.'+actionString| translate }}</div>
    <mat-stepper linear #stepper>
        <mat-step [stepControl]="basicInfoForm" isOptional="true">
            <form [formGroup]="basicInfoForm" class="ui form form">
                <ng-template matStepLabel>{{ 'FORM.STEPS.BASIC_INFO' | translate }}</ng-template>

                @for(key of this.key.basicInfo; track key) {
                @if(!hiddenField.includes(key.field)) {
                <div class="inline field">
                    <label>{{ 'MOBILE_POST.FIELDS.' + key.field| translate}}</label>

                    @switch (key.type) {
                    @case ('text'){
                    <input type="text" formControlName="{{key.field}}" [matAutocomplete]="auto">

                    <mat-autocomplete #auto="matAutocomplete">
                        @for (option of filteredOptions[key.field] | async; track option) {
                        <mat-option [value]="option">{{option}}</mat-option>
                        }
                    </mat-autocomplete>
                    }
                    @case ('number') {
                    <input type="number" formControlName="{{key.field}}" max="{{key.max}}" min="{{key.min}}">
                    }
                    @case ('time') {
                    <input type="time" formControlName="{{key.field}}">

                    }
                    @default {}

                    }
                    {{basicInfoForm.get(key.field)?.errors| json}}

                </div>
                }

                }

            </form>
            <div>
                <button class="ui button submit-button" matButton matStepperNext>Next</button>
            </div>
        </mat-step>
        <mat-step [stepControl]="locationForm">
            <form [formGroup]="locationForm" class="ui form form">
                <ng-template matStepLabel>{{ 'FORM.STEPS.LOCATION' | translate }}</ng-template>

                @for(key of locationFormKey; track key) {

                @if(!hiddenField.includes(key)) {
                <div class="inline field">
                    @if($index == 0) {
                    <div id="map"> </div>
                    }
                    <label>{{ 'MOBILE_POST.FIELDS.' + key | translate}}</label>


                    <input type="text" formControlName="{{key}}" [matAutocomplete]="auto">


                    <mat-autocomplete #auto="matAutocomplete">
                        @for (option of filteredOptions[key] | async; track option) {
                        <mat-option [value]="option">{{option}}</mat-option>
                        }
                    </mat-autocomplete>
                    {{locationForm.get(key)?.errors| json}}


                </div>
                }

                }
            </form>
            <div>
                <button class="ui button back-button" matButton matStepperPrevious>Back</button>

                <button class="ui button submit-button" matButton matStepperNext>Next</button>
            </div>
        </mat-step>
        <mat-step>
            <ng-template matStepLabel>Done</ng-template>
            <p>Your changes list : </p>
            <form class="ui form form">
            @for (key of getChangedKeys(); track key) {
               <div class="inline field">
                
                    <label>{{ 'MOBILE_POST.FIELDS.' + key | translate}}</label>
                    <!-- <input type="text" formControlName="{{key}}" readonly [value]="getFormValueByKey(key)"> -->
                </div>
            }
            </form>
            <div>
                <button class="ui button back-button"  matButton matStepperPrevious>Back</button>
                <button class="ui button reset-button" matButton (click)="reset()">Reset</button>
                <button class="ui button submit-button" matButton (click)="onSubmit()">Submit</button>
            </div>
        </mat-step>
    </mat-stepper>

</div>